node {

    def buildImage = docker.image("conanio/gcc8-armv7hf")
    buildImage.inside("--network rt_cont_int") {

        load "$JENKINS_HOME/workspace/RC_Car/ci/variables.groovy"
        def server = Artifactory.server "${env.ARTIFACTORY_NAME}".toString()
        def client = Artifactory.newConanClient()
        def serverName = client.remote.add server: server, repo: "${env.ARTIFACTORY_REPO}".toString()

        stage("Get project"){
            checkout scm
        }

        stage("Get dependencies and create app") {
            String strCommand = "create . radugrecu97/experimental -pr ./ci/rpi_gcc8 --build missing"
            client.run(command: strCommand)
        }

        stage("Upload packages") {
            String command = "upload RC_Car* --all -r ${serverName} --confirm"
            def b = client.run(command: command)
            b.env.collect()
            server.publishBuildInfo b
        }

//         stage("Test project") {
//             node (label: 'slave-rpi') {
//
//             }
//         }

    }

}

